(executables):
  dart: fvm dart
  flutter: fvm flutter

setup:
  hooks: dart run hooksman
  mason:
    (command):
      - |
        cd mason/mason_templates
        dart run brick_oven cook all --output ../dart_bricks --sync
      - |
        cd mason/dart_bricks
        rm -rf .mason

        dart run mason_cli:mason get
        dart run mason_cli:mason list

build_runner:
  (aliases): br
  build:
    (aliases): b
    (command): ${{ dart }} run build_runner build --force-aot
    application: cd packages/application; ${{ build_runner.build }}
    domain: cd packages/domain; ${{ build_runner.build }}
    data: cd packages/data; ${{ build_runner.build }}

  watch:
    (aliases): w
    (command): ${{ dart }} run build_runner watch --force-aot
    application: cd packages/application; ${{ build_runner.watch }}
    domain: cd packages/domain; ${{ build_runner.watch }}
    data: cd packages/data; ${{ build_runner.watch }}

clean:
  ios:
    - cd ios; pod deintegrate; rm -rf Podfile.lock
    - flutter clean
    - flutter pub get
    - cd ios; pod install --repo-update

init: flutterfire configure

pod:
  clean: cd ios; pod deintegrate; rm -rf Podfile.lock; cd ..; flutter pub get; cd ios; pod install --repo-update

fpg: flutter pub get

spider:
  (aliases): s
  init: spider create --add-in-pubspec
  build: spider build

web:
  build: flutter build web --release --wasm

barrel:
  (command):
    - ${{ barrel.install }}
    - ${{ barrel.build }}
  install: |
    # check if barreler exe can be executed
    if command -v barreler >/dev/null 2>&1; then
      echo "Barreler exe found"
      exit 0
    fi

    ${{ dart }} pub global activate barreler

  build: barreler build --config barreler.yaml

create:
  bloc:
    - |
      BLOCS=packages/application/lib/src/blocs
      ABSOLUTE="$(realpath "$BLOCS")"
      echo "Generating Bloc in $BLOCS"
      cd mason/dart_bricks
      dart run mason_cli:mason make bloc -o "$ABSOLUTE"
    - ${{ barrel }}
